<!-- Put this BEFORE the <script src="app.js"></script> line in index.html -->
<script>
/* === Password + Hardening script ===
   - Compares SHA-256(password) with stored digest (split/joined to reduce visibility)
   - Disables right-click and common DevTools keys
   - Detects DevTools (heuristic) and shows blocking overlay
   Note: This is client-side protection / deterrent, not full security.
*/

// precomputed SHA-256 of "Crazytrader@1234" (hex)
const storedHashParts = [
  "fa556104", "2a14f0cf", "1d535087", "c78d97f5",
  "6273b8c6", "9da9234b", "1984a099", "bedc1899"
];
const STORED_HASH_HEX = storedHashParts.join("");

// helpers
async function sha256Hex(message) {
  const enc = new TextEncoder();
  const data = enc.encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
}

const lockScreen = document.getElementById("lockScreen");
const mainContent = document.getElementById("mainContent");
const unlockBtn = document.getElementById("unlockBtn");
const passwordInput = document.getElementById("passwordInput");
const errorMsg = document.getElementById("errorMsg");

// overlay shown when devtools suspected
let devtoolsOverlay = null;
function showDevtoolsOverlay() {
  if (devtoolsOverlay) return;
  devtoolsOverlay = document.createElement('div');
  devtoolsOverlay.style.position = 'fixed';
  devtoolsOverlay.style.inset = '0';
  devtoolsOverlay.style.background = 'rgba(0,0,0,0.95)';
  devtoolsOverlay.style.zIndex = '99999';
  devtoolsOverlay.style.display = 'flex';
  devtoolsOverlay.style.justifyContent = 'center';
  devtoolsOverlay.style.alignItems = 'center';
  devtoolsOverlay.style.color = '#ff6b6b';
  devtoolsOverlay.style.fontSize = '20px';
  devtoolsOverlay.style.fontFamily = 'Inter, sans-serif';
  devtoolsOverlay.innerText = 'Security lock: page disabled while DevTools is open.';
  document.body.appendChild(devtoolsOverlay);
}

// remove overlay
function removeDevtoolsOverlay() {
  if (!devtoolsOverlay) return;
  devtoolsOverlay.remove();
  devtoolsOverlay = null;
}

// unlock logic
unlockBtn.addEventListener("click", async () => {
  const val = passwordInput.value || '';
  // quick UI feedback
  unlockBtn.disabled = true;
  unlockBtn.textContent = "Checking...";
  try {
    const h = await sha256Hex(val);
    if (h === STORED_HASH_HEX) {
      // success
      lockScreen.classList.add("hidden");
      mainContent.classList.remove("hidden");
      errorMsg.classList.add("hidden");
      // remove any devtools overlay if present
      removeDevtoolsOverlay();
    } else {
      errorMsg.classList.remove("hidden");
    }
  } catch (e) {
    console.error("hash error", e);
    errorMsg.classList.remove("hidden");
  } finally {
    unlockBtn.disabled = false;
    unlockBtn.textContent = "Unlock";
    passwordInput.value = "";
  }
});

// disable right-click
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
}, false);

// block common devtools keyboard shortcuts
document.addEventListener('keydown', function (e) {
  // F12, Ctrl+Shift+I/J/C, Ctrl+U, Ctrl+Shift+C, Ctrl+Shift+J
  if (e.key === 'F12') e.preventDefault();
  if (e.ctrlKey && e.key.toLowerCase() === 'u') e.preventDefault();
  if (e.ctrlKey && e.shiftKey && (e.key.toLowerCase() === 'i' || e.key.toLowerCase() === 'j' || e.key.toLowerCase() === 'c')) e.preventDefault();
  if (e.ctrlKey && e.key.toLowerCase() === 's') { /* allow save? prevent if you want */ }
}, false);

// heuristic devtools detection
let devtoolsOpen = false;
function checkDevTools() {
  // Heuristics: large difference between outer and inner dimensions (DevTools docked),
  // or using the special console trick.
  const threshold = 160; // px difference considered suspicious
  const widthDiff = Math.abs(window.outerWidth - window.innerWidth);
  const heightDiff = Math.abs(window.outerHeight - window.innerHeight);
  const suspicious = widthDiff > threshold || heightDiff > threshold;

  // Another check: opening a debugger statement and measuring time (slow trick).
  let start = performance.now();
  debugger; // modern browsers may ignore it if DevTools closed
  let elapsed = performance.now() - start;

  const slow = elapsed > 100; // if debugger paused/stepped, elapsed will be high

  if (suspicious || slow) {
    if (!devtoolsOpen) {
      devtoolsOpen = true;
      showDevtoolsOverlay();
    }
  } else {
    if (devtoolsOpen) {
      devtoolsOpen = false;
      removeDevtoolsOverlay();
    }
  }
}

// run check periodically
setInterval(checkDevTools, 1000);

// extra: try to detect open via DevTools-dedicated API (nonstandard)
if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__ || /Chrome/.test(navigator.userAgent) && window.devtools) {
  showDevtoolsOverlay();
}

// Final note: this is a deterrent for casual users, not absolute security.
</script>
